<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SukiMart - Online Shopping</title>
  <style>
    /* --- Base / Reset --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root{
      --brand:#ee4d2d; --brand-2:#ff6b35; --danger:#ff4757; --text:#333; --muted:#666;
      --chip:#ffc107; --bg:#f5f5f5; --card:#fff; --shadow:0 2px 10px rgba(0,0,0,.1);
      --grad: linear-gradient(135deg,var(--brand),var(--brand-2));
    }
    body{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:var(--bg); color:var(--text); }

    /* --- Header --- */
    .header{ background:var(--grad); color:#fff; padding:1rem 0; position:sticky; top:0; z-index:100; box-shadow:0 2px 10px rgba(238,77,45,.3) }
    .header-container{ max-width:1200px; margin:0 auto; padding:0 1rem; display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap }
    .logo{ color:#fff; text-decoration:none; font-weight:800; font-size:1.8rem }
    
    /* Navigation Menu */
    .nav-menu{ display:flex; align-items:center; gap:1.5rem }
    .nav-menu a{ color:#fff; text-decoration:none; font-weight:600; padding:.5rem 1rem; border-radius:6px; transition:background .2s }
    .nav-menu a:hover{ background:rgba(255,255,255,.15) }
    .nav-menu a.active{ background:rgba(255,255,255,.2); font-weight:800 }
    
    .search-container{ flex:1; max-width:500px; position:relative }
    .search-box{ width:100%; padding:.8rem 1rem; border:none; border-radius:6px; font-size:1rem; outline:none }

    .header-actions{ display:flex; align-items:center; gap:.75rem }
    .add-item-btn{ background:rgba(255,255,255,.2); color:#fff; border:1px solid rgba(255,255,255,.3); padding:.6rem 1rem; border-radius:6px; cursor:pointer; font-weight:600 }
    .add-item-btn:hover{ background:rgba(255,255,255,.3) }

    /* Bigger, high-contrast cart button */
    .cart-icon{ position:relative; background:#fff; color:var(--brand); border:none; padding:.7rem 1rem; border-radius:999px; cursor:pointer; font-weight:800; display:flex; align-items:center; gap:.5rem; box-shadow:0 4px 16px rgba(0,0,0,.12) }
    .cart-icon .icon{ font-size:1.4rem; line-height:0 }
    .cart-icon .label{ font-size:1rem }
    .cart-count{ position:absolute; top:-6px; right:-6px; background:var(--danger); color:#fff; border-radius:50%; width:24px; height:24px; font-size:.8rem; display:flex; align-items:center; justify-content:center; font-weight:800; box-shadow:0 2px 6px rgba(0,0,0,.2) }

    /* --- Layout --- */
    .container{ max-width:1200px; margin:0 auto; padding:2rem 1rem; position:relative }

    /* --- Products grid --- */
    .products-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:1.5rem }
    .product-card{ background:var(--card); border-radius:10px; overflow:hidden; box-shadow:var(--shadow); transition:.25s transform,.25s box-shadow; position:relative }
    .product-card:hover{ transform:translateY(-4px); box-shadow:0 10px 28px rgba(0,0,0,.15) }
    .product-card.custom-item{ border:2px solid var(--brand) }
    .custom-badge{ position:absolute; top:10px; right:10px; background:var(--brand); color:#fff; padding:.2rem .5rem; border-radius:12px; font-size:.7rem; font-weight:800 }

    .product-image{ width:100%; height:200px; object-fit:cover }
    .product-info{ padding:1rem }
    .product-name{ font-size:1rem; font-weight:700; margin-bottom:.5rem; color:#222; line-height:1.4 }
    .product-price{ font-size:1.25rem; font-weight:800; color:var(--brand); margin-bottom:.5rem }
    .product-rating{ display:flex; align-items:center; gap:.5rem; margin-bottom:1rem }
    .stars{ color:var(--chip) }
    .rating-text{ color:var(--muted); font-size:.9rem }

    .card-actions{ display:flex; gap:.5rem; flex-wrap:wrap }
    .btn{ padding:.65rem .9rem; border:none; border-radius:8px; cursor:pointer; font-weight:700 }
    .btn-primary{ background:var(--brand); color:#fff }
    .btn-primary:hover{ background:#d63821 }
    .btn-ghost{ background:#f3f3f3 }
    .btn-ghost:hover{ background:#e9e9e9 }
    .btn-danger{ background:var(--danger); color:#fff }
    .btn-danger:hover{ filter:brightness(.95) }

    /* --- Sidebar cart --- */
    .cart-sidebar{ position:fixed; top:0; right:-420px; width:420px; height:100vh; background:#fff; box-shadow:-2px 0 20px rgba(0,0,0,.15); transition:right .3s; z-index:200; display:flex; flex-direction:column }
    .cart-sidebar.open{ right:0 }
    .cart-header{ padding:1.2rem 1rem; background:var(--brand); color:#fff; display:flex; align-items:center; justify-content:space-between }
    .cart-title{ font-size:1.2rem; font-weight:800 }
    .close-cart{ background:#fff; color:var(--brand); border:none; padding:.6rem 1rem; border-radius:999px; font-weight:800; cursor:pointer }

    .cart-items{ flex:1; padding:1rem; overflow-y:auto }
    .cart-item{ display:flex; align-items:center; gap:1rem; padding:1rem 0; border-bottom:1px solid #eee }
    .cart-item-image{ width:60px; height:60px; border-radius:6px; object-fit:cover }
    .cart-item-name{ font-weight:700; font-size:.95rem; color:#222 }
    .cart-item-price{ color:var(--brand); font-weight:800 }
    .quantity-controls{ display:flex; align-items:center; margin-top:.35rem }
    .quantity-btn{ background:#f0f0f0; border:1px solid #ddd; width:32px; height:32px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1rem; border-radius:6px }
    .quantity-input{ width:48px; text-align:center; border:1px solid #ddd; border-left:none; border-right:none; height:32px; font-size:1rem }
    .remove-item{ background:var(--danger); color:#fff; border:none; padding:.5rem .7rem; border-radius:8px; cursor:pointer; font-size:.85rem }

    .cart-footer{ padding:1rem; border-top:1px solid #eee; background:#fafafa }
    .cart-total{ font-size:1.2rem; font-weight:800; color:#222; text-align:center; margin-bottom:1rem }
    .checkout-btn{ width:100%; padding:1rem; background:var(--brand); color:#fff; border:none; border-radius:8px; font-weight:800; font-size:1.05rem; cursor:pointer }

    /* --- Modal (generic) --- */
    .overlay{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; z-index:150 }
    .overlay.active{ display:block }

    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:300; animation:fadeIn .25s ease-out; padding:1rem }
    .modal.active{ display:flex }
    .modal-content{ background:#fff; border-radius:14px; width:92%; max-width:560px; max-height:85vh; overflow:auto; box-shadow:0 20px 40px rgba(0,0,0,.18); animation:slideUp .25s ease-out }
    .modal-header{ text-align:center; margin-bottom:1rem }
    .modal-header h2{ color:var(--brand); font-size:1.5rem; margin-bottom:.25rem }
    .modal-header p{ color:var(--muted) }

    /* Redesigned success modal hero */
    .modal-hero{
      background: var(--grad);
      color:#fff;
      padding:1.25rem 1rem;
      border-radius:14px 14px 0 0;
      display:flex; align-items:center; gap:.75rem;
    }
    .modal-hero .hero-icon{ font-size:1.6rem }
    .modal-hero .hero-title{ font-weight:900; letter-spacing:.3px }
    .modal-content .content-body{ padding:1.25rem }

    .order-summary h3{ margin:1rem 0; font-size:1.1rem }
    .order-item{ display:flex; align-items:center; gap:1rem; padding:.6rem 0; border-bottom:1px solid #eee }
    .order-item:last-child{ border-bottom:none }
    .order-item-image{ width:56px; height:56px; border-radius:6px; object-fit:cover }
    .order-item-name{ font-weight:700; color:#222; font-size:.95rem }
    .order-item-price{ color:var(--brand); font-weight:800; font-size:.95rem }
    .order-total{ text-align:center; padding:1rem 0; border-top:2px solid #eee; font-size:1.25rem; font-weight:800; color:var(--brand) }

    .modal-actions{ display:flex; gap:.5rem; margin-top:1rem }

    /* --- Add/Edit product form --- */
    .add-item-form{ background:#fff; border-radius:10px; padding:1.2rem; margin-bottom:2rem; box-shadow:var(--shadow); display:none }
    .add-item-form.active{ display:block }
    .form-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem }
    .form-header h3{ color:var(--brand); font-size:1.25rem }
    .close-form-btn{ background:#f3f3f3; border:none; padding:.6rem 1rem; border-radius:999px; cursor:pointer; font-weight:800 }

    .form-grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:1rem }
    .form-group{ display:flex; flex-direction:column; gap:.4rem }
    .form-group label{ font-weight:700; color:#222 }
    .form-group input[type="text"], .form-group input[type="number"]{ padding:.8rem; border:1px solid #ddd; border-radius:8px; font-size:1rem; outline:none }
    .form-group input:focus{ border-color:var(--brand); box-shadow:0 0 0 2px rgba(238,77,45,.1) }

    /* Redesigned image picker & preview */
    .image-picker{ 
      display:flex; flex-direction:column; align-items:center; gap:1rem; 
      padding:1.5rem; background:#fafafa; border-radius:12px; border:2px dashed #ddd;
      transition: border-color .3s, background .3s;
    }
    .image-picker:hover{ border-color:var(--brand); background:#f9f9f9 }
    .image-picker.has-image{ border-color:var(--brand); border-style:solid; background:#fff }
    
    .image-preview-container{ position:relative; display:flex; align-items:center; justify-content:center }
    .image-preview{ 
      width:150px; height:150px; border-radius:12px; object-fit:cover; 
      background:#e9e9e9; display:none; box-shadow:0 4px 12px rgba(0,0,0,.1);
      border:3px solid #fff;
    }
    .image-preview.has-image{ display:block }
    
    .image-placeholder{ 
      width:150px; height:150px; border-radius:12px; 
      background:linear-gradient(135deg, #f0f0f0, #e5e5e5);
      display:flex; align-items:center; justify-content:center; flex-direction:column;
      color:#999; font-size:.9rem; font-weight:600;
      border:2px dashed #ccc;
    }
    .image-placeholder .icon{ font-size:2rem; margin-bottom:.5rem; opacity:.7 }
    
    .file-input-wrapper{ position:relative; display:inline-block }
    .file-input-styled{ 
      background:var(--brand); color:#fff; padding:.75rem 1.5rem; 
      border-radius:8px; cursor:pointer; font-weight:700; 
      transition:background .2s; display:inline-block;
    }
    .file-input-styled:hover{ background:#d63821 }
    .file-input-styled.has-image{ background:#28a745 }
    .file-input-styled.has-image:hover{ background:#218838 }
    #productImageFile{ display:none }
    
    .remove-image-btn{ 
      position:absolute; top:-8px; right:-8px; 
      background:var(--danger); color:#fff; border:none; 
      width:28px; height:28px; border-radius:50%; 
      cursor:pointer; font-size:.85rem; font-weight:800;
      display:none; box-shadow:0 2px 6px rgba(0,0,0,.2);
    }
    .remove-image-btn.show{ display:block }
    .remove-image-btn:hover{ background:#dc3545 }

    .submit-item-btn{ width:100%; padding:1rem; background:var(--brand); color:#fff; border:none; border-radius:10px; font-weight:800; font-size:1.05rem; cursor:pointer; margin-top:.5rem }

    /* --- Delete confirmation modal --- */
    .confirm-text{ text-align:center; color:#444; margin:.25rem 0 .75rem }
    .confirm-actions{ display:flex; gap:.5rem; justify-content:center }

    /* --- Empty cart --- */
    .empty-cart{ text-align:center; padding:2rem; color:#fff; background: linear-gradient(180deg, rgba(238,77,45,.9), rgba(255,107,53,.85)); border-radius:10px }
    .empty-cart small{ display:block; opacity:.9; margin-top:.25rem }

    /* --- Animations --- */
    @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
    @keyframes slideUp{ from{opacity:0; transform:translateY(30px)} to{opacity:1; transform:none} }
    @keyframes bump {
      0% { transform: translateY(0) scale(1); }
      30% { transform: translateY(-2px) scale(1.03); }
      60% { transform: translateY(0) scale(0.98); }
      100% { transform: translateY(0) scale(1); }
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(255,255,255,.7); }
      70% { box-shadow: 0 0 0 12px rgba(255,255,255,0); }
      100% { box-shadow: 0 0 0 0 rgba(255,255,255,0); }
    }
    @keyframes barBounce {
      0% { transform: translateY(0); }
      30% { transform: translateY(-6px); }
      60% { transform: translateY(0); }
      100% { transform: translateY(0); }
    }

    /* --- Mobile Buy Now Bar --- */
    .buy-now-wrap{
      position: fixed;
      left: 0; bottom: 0; width: 100%;
      z-index: 300;
      pointer-events: none; /* container only */
    }
    .buy-now-bar{
      pointer-events: auto;
      background: var(--grad);
      color:#fff;
      display:flex; align-items:center; justify-content:space-between;
      padding:.85rem 1rem;
      gap:.75rem;
      transform: translateY(110%);
      opacity: 0;
      transition: transform .32s ease, opacity .32s ease;
      box-shadow: 0 -10px 24px rgba(238,77,45,.25);
    }
    .buy-now-bar.show{
      transform: translateY(0);
      opacity: 1;
    }
    .buy-now-bar.bounce{ animation: barBounce .45s ease-out 1; }
    .buy-summary{ font-weight:900; letter-spacing:.2px }
    .buy-summary .count{ font-weight:900 }
    .buy-summary .total{ font-weight:900 }
    .buy-now-btn{
      background:#fff; color:var(--brand);
      border:none; border-radius:999px; padding:.65rem 1.2rem;
      font-weight:900; cursor:pointer; box-shadow:0 6px 14px rgba(0,0,0,.18);
      display:flex; align-items:center; gap:.5rem;
      transition: transform .15s ease;
    }
    .buy-now-btn.bump{ animation: bump .4s ease both; }
    .buy-now-btn.pulse{ animation: pulse 1.1s ease-out 1; }

    .buy-now-bar.highlight{ outline: 2px dashed rgba(255,255,255,.9); outline-offset:-6px; border-radius:8px }

    /* --- Mobile-centered notifications --- */
    .toast{
      position: fixed; z-index: 400; 
      background: var(--brand); color:#fff; font-weight:800;
      padding:12px 16px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,.2);
      transition: opacity .4s ease;
    }
    /* default desktop placement (bottom-right) */
    .toast.desktop{ bottom:20px; right:20px; }
    /* mobile: center of screen, away from Buy Now bar */
    @media (max-width: 768px){
      .toast.mobile{
        top: 50%; left: 50%; transform: translate(-50%, -50%);
        max-width: 88%; text-align:center;
      }
      .container{ padding:1rem 1rem 5.5rem } /* bottom padding for the bar */
    }

    /* --- Mobile Cart Modal --- */
    .mobile-cart-modal{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:none; z-index:250; align-items:flex-end }
    .mobile-cart-modal.active{ display:flex }
    .mobile-cart-content{ background:#fff; width:100%; max-height:80vh; border-radius:20px 20px 0 0; display:flex; flex-direction:column; animation:slideUpMobile .3s ease-out }
    .mobile-cart-header{ padding:1.2rem 1rem; background:var(--brand); color:#fff; display:flex; align-items:center; justify-content:space-between; border-radius:20px 20px 0 0 }
    .mobile-cart-title{ font-size:1.2rem; font-weight:800 }
    .close-mobile-cart{ background:#fff; color:var(--brand); border:none; padding:.6rem 1rem; border-radius:999px; font-weight:800; cursor:pointer }
    .mobile-cart-items{ flex:1; padding:1rem; overflow-y:auto; max-height:50vh }
    .mobile-cart-footer{ padding:1rem; border-top:1px solid #eee; background:#fafafa }
    .back-to-shop{ width:100%; padding:.8rem; background:#f3f3f3; color:var(--text); border:none; border-radius:8px; font-weight:700; font-size:1rem; cursor:pointer; margin-bottom:.5rem }
    .back-to-shop:hover{ background:#e9e9e9 }
    
    /* Hide buy now bar when mobile cart modal is open */
    .mobile-cart-modal.active ~ .buy-now-wrap .buy-now-bar{ display:none !important; }
    
    @keyframes slideUpMobile{ from{transform:translateY(100%)} to{transform:translateY(0)} }
    
    /* --- Mobile responsive navigation and layout --- */
    @media (max-width: 768px){
      .header-container{ flex-direction:column; gap:.75rem; padding:1rem }
      .nav-menu{ order:-1; width:100%; justify-content:center; gap:2rem; margin-bottom:.5rem }
      .search-container{ order:1; width:100%; max-width:none }
      .header-actions{ order:2; width:100%; justify-content:space-between }
      .add-item-btn, .cart-icon{ flex:1; justify-content:center }
      
      /* Show mobile cart modal instead of sidebar */
      .cart-sidebar{ display:none !important; }
      .buy-now-wrap{ display:block; }
      .buy-now-wrap.hide{ display:none !important; }
      .container{ padding:1rem } /* remove extra bottom padding */
      
      /* Hide back to shop button in mobile cart modal */
      .back-to-shop{ display:none !important; }
    }
    @media (min-width: 769px){
      .buy-now-wrap{ display:none; }
    }

    /* --- Compact product cards on very small screens --- */
    @media (max-width: 480px){
      .products-grid{ grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); gap:1rem }
      .product-image{ height:160px }
      .product-info{ padding:.8rem }
      .product-name{ font-size:.95rem }
      .product-price{ font-size:1.1rem; margin-bottom:.4rem }
      .product-rating{ margin-bottom:.8rem }
      .btn{ padding:.55rem .75rem; font-weight:800 }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-container">
      <a class="logo" href="index.html">🛍️ SukiMart</a>
      
      <!-- Navigation Menu -->
      <nav class="nav-menu">
        <a href="index.html" class="active">Products</a>
        <a href="#" id="navCartToggle">Cart</a>
        <a href="about us.html">About Us</a>
      </nav>
      
      <div class="search-container">
        <input id="searchInput" class="search-box" type="text" placeholder="Search for products..." />
      </div>
      <div class="header-actions">
        <button id="addItemToggle" class="add-item-btn">+ Add Item</button>
        <button id="cartToggle" class="cart-icon" title="Open Cart">
          <span class="icon">🛒</span>
          <span class="label">Cart</span>
          <span id="cartCount" class="cart-count">0</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <div class="container">
    <!-- Add/Edit Item Form -->
    <div id="addItemForm" class="add-item-form">
      <div class="form-header">
        <h3 id="formTitle">Add New Product</h3>
        <button id="closeForm" class="close-form-btn">Close</button>
      </div>
      <form id="productForm">
        <input type="hidden" id="editingId" value="" />
        <div class="form-grid">
          <div class="form-group">
            <label for="productName">Product Name</label>
            <input id="productName" type="text" required />
          </div>
          <div class="form-group">
            <label for="productPrice">Price (₱)</label>
            <input id="productPrice" type="number" step="0.01" min="0" required />
          </div>
          <div class="form-group">
            <label for="productRating">Rating (1-5)</label>
            <input id="productRating" type="number" min="1" max="5" step="0.1" value="4.0" required />
          </div>
          <div class="form-group">
            <label>Product Image</label>
            <div class="image-picker" id="imagePicker">
              <div class="image-preview-container">
                <div class="image-placeholder" id="imagePlaceholder">
                  <div class="icon">📷</div>
                  <div>No image selected</div>
                </div>
                <img id="imagePreview" class="image-preview" alt="Preview" />
                <button type="button" class="remove-image-btn" id="removeImageBtn">×</button>
              </div>
              <div class="file-input-wrapper">
                <input id="productImageFile" type="file" accept="image/*" />
                <label for="productImageFile" class="file-input-styled" id="fileInputLabel">
                  Choose Image
                </label>
              </div>
            </div>
          </div>
        </div>
        <button class="submit-item-btn" type="submit">Save Product</button>
      </form>
    </div>

    <!-- Grid -->
    <div id="productsGrid" class="products-grid"></div>
  </div>

  <!-- Cart Sidebar (desktop only) -->
  <aside id="cartSidebar" class="cart-sidebar">
    <div class="cart-header">
      <div class="cart-title">Shopping Cart</div>
      <button id="closeCart" class="close-cart">Close</button>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer">
      <div id="cartTotal" class="cart-total">Total: ₱0.00</div>
      <button class="checkout-btn" onclick="checkout()">Checkout</button>
    </div>
  </aside>

  <!-- Checkout Modal -->
  <div id="checkoutModal" class="modal">
    <div class="modal-content">
      <div class="modal-hero">
        <div class="hero-icon">🎉</div>
        <div>
          <div class="hero-title">Order Successful!</div>
          <div style="opacity:.9">Thank you for your purchase</div>
        </div>
      </div>
      <div class="content-body">
        <div class="order-summary">
          <h3>Order Summary</h3>
          <div id="orderItems"></div>
          <div id="orderTotal" class="order-total"></div>
        </div>
        <div style="text-align:center; margin:1rem 0; padding:1rem; background:#f9f9f9; border-radius:8px;">
          <h3 style="color:var(--brand); margin-bottom:.5rem;">Please come shop again! 😊</h3>
          <p style="color:var(--muted);">We appreciate your business and look forward to serving you again.</p>
        </div>
        <div class="modal-actions" style="justify-content:center">
          <button id="closeModal" class="btn btn-primary">Continue Shopping</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Delete product?</h2>
        <p class="confirm-text">This action cannot be undone.</p>
      </div>
      <div class="confirm-actions">
        <button id="confirmDeleteBtn" class="btn btn-danger">Delete</button>
        <button id="cancelDeleteBtn" class="btn btn-ghost">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Shared overlay -->
  <div id="overlay" class="overlay"></div>

  <!-- Mobile Cart Modal -->
  <div id="mobileCartModal" class="mobile-cart-modal">
    <div class="mobile-cart-content">
      <div class="mobile-cart-header">
        <div class="mobile-cart-title">Shopping Cart</div>
        <button id="closeMobileCart" class="close-mobile-cart">Close</button>
      </div>
      <div id="mobileCartItems" class="mobile-cart-items"></div>
      <div class="mobile-cart-footer">
        <button class="back-to-shop" onclick="closeMobileCart()">← Back to Shop</button>
        <div id="mobileCartTotal2" class="cart-total">Total: ₱0.00</div>
        <button class="checkout-btn" onclick="checkout()">Checkout</button>
      </div>
    </div>
  </div>

  <!-- Mobile Buy Now Bar -->
  <div class="buy-now-wrap" aria-hidden="true">
    <div id="buyNowBar" class="buy-now-bar" role="region" aria-label="Quick checkout bar">
      <div class="buy-summary">
        🛒 <span class="count" id="mobileCartCount">0</span> • ₱<span class="total" id="mobileCartTotal">0.00</span>
      </div>
      <button id="buyNowBtn" class="buy-now-btn" aria-label="Checkout">
        <span>Checkout</span> ➜
      </button>
    </div>
  </div>

  <script>
    // --- Data ---
    let products = [
      { id:1, name:"Cow Feeder", price:2999.50, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/cowfeeder.jpg", rating:4.5, reviews:128, isCustom:false, usesObjectURL:false },
      { id:2, name:"Piglet Heat Lamp", price:1499.75, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/pigheatlamp.jpg", rating:4.7, reviews:89, isCustom:false, usesObjectURL:false },
      { id:3, name:"Chicken Waterer", price:899.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/chickwaterer.png", rating:4.3, reviews:156, isCustom:false, usesObjectURL:false },
      { id:4, name:"Livestock Injection Syringe", price:399.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/lis.jpg", rating:4.6, reviews:203, isCustom:false, usesObjectURL:false },
      { id:5, name:"Automatic Cow Water Bowl", price:1999.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/acwb.jpg", rating:4.4, reviews:94, isCustom:false, usesObjectURL:false },
      { id:6, name:"Pig Ear Tag Set", price:1249.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/pets.jpg", rating:4.2, reviews:67, isCustom:false, usesObjectURL:false },
      { id:7, name:"Chicken Incubator", price:2499.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/chicki.jpg", rating:4.5, reviews:112, isCustom:false, usesObjectURL:false },
      { id:8, name:"Livestock Mineral Block", price:749.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/lmb.jpg", rating:4.1, reviews:78, isCustom:false, usesObjectURL:false },
      { id:9, name:"Cattle Hoof Trimmer", price:3499.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/cht.jpg", rating:4.6, reviews:92, isCustom:false, usesObjectURL:false },
      { id:10, name:"Poultry Feed Dispenser", price:1799.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/pfd.jpg", rating:4.4, reviews:145, isCustom:false, usesObjectURL:false },
      { id:11, name:"Animal Weighing Scale", price:5999.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/aws.jpg", rating:4.8, reviews:167, isCustom:false, usesObjectURL:false },
      { id:12, name:"Veterinary Stethoscope", price:899.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/vs.jpg", rating:4.7, reviews:88, isCustom:false, usesObjectURL:false },
      { id:13, name:"Cattle Dehorning Tool", price:2799.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/cdt.jpg", rating:4.3, reviews:73, isCustom:false, usesObjectURL:false },
      { id:14, name:"Pig Farrowing Crate", price:4999.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/pfc.jpg", rating:4.5, reviews:95, isCustom:false, usesObjectURL:false },
      { id:15, name:"Animal Temperature Gun", price:1299.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/atg.jpg", rating:4.6, reviews:182, isCustom:false, usesObjectURL:false },
      { id:16, name:"Livestock Feed Cart", price:3299.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/lfc.jpg", rating:4.4, reviews:64, isCustom:false, usesObjectURL:false },
      { id:17, name:"Milk Collection Unit", price:6999.99, image:"https://raw.githubusercontent.com/valiantheartsx-coder/sukimart/main/amcu.jpg", rating:4.9, reviews:134, isCustom:false, usesObjectURL:false }
    ];

    let cart = [];
    let nextId = 18;
    let deleteCandidateId = null;

    // --- DOM ---
    const productsGrid = document.getElementById('productsGrid');
    const cartSidebar = document.getElementById('cartSidebar');
    const cartToggle = document.getElementById('cartToggle');
    const closeCart = document.getElementById('closeCart');
    const overlay = document.getElementById('overlay');
    const cartItems = document.getElementById('cartItems');
    const cartCount = document.getElementById('cartCount');
    const cartTotal = document.getElementById('cartTotal');
    const searchInput = document.getElementById('searchInput');

    // Form elements
    const addItemToggle = document.getElementById('addItemToggle');
    const addItemForm = document.getElementById('addItemForm');
    const closeForm = document.getElementById('closeForm');
    const productForm = document.getElementById('productForm');
    const formTitle = document.getElementById('formTitle');
    const editingId = document.getElementById('editingId');
    const productName = document.getElementById('productName');
    const productPrice = document.getElementById('productPrice');
    const productRating = document.getElementById('productRating');
    const productImageFile = document.getElementById('productImageFile');
    const imagePreview = document.getElementById('imagePreview');
    
    // Image picker elements
    const imagePicker = document.getElementById('imagePicker');
    const imagePlaceholder = document.getElementById('imagePlaceholder');
    const removeImageBtn = document.getElementById('removeImageBtn');
    const fileInputLabel = document.getElementById('fileInputLabel');

    // Modals
    const checkoutModal = document.getElementById('checkoutModal');
    const closeModal = document.getElementById('closeModal');
    const orderItems = document.getElementById('orderItems');
    const orderTotal = document.getElementById('orderTotal');

    const deleteModal = document.getElementById('deleteModal');
    const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
    const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');

    // Mobile Buy Now bar
    const buyNowBar = document.getElementById('buyNowBar');
    const buyNowBtn = document.getElementById('buyNowBtn');
    const mobileCartCount = document.getElementById('mobileCartCount');
    const mobileCartTotal = document.getElementById('mobileCartTotal');
    
    // Navigation elements
    const navCartToggle = document.getElementById('navCartToggle');
    const buyNowWrap = document.querySelector('.buy-now-wrap');
    
    // Mobile cart modal elements
    const mobileCartModal = document.getElementById('mobileCartModal');
    const closeMobileCart = document.getElementById('closeMobileCart');
    const mobileCartItems = document.getElementById('mobileCartItems');
    const mobileCartTotal2 = document.getElementById('mobileCartTotal2');

    // --- LocalStorage Functions ---
    function saveToLocalStorage() {
      try {
        localStorage.setItem('sukimart_products', JSON.stringify(products));
        localStorage.setItem('sukimart_cart', JSON.stringify(cart));
        localStorage.setItem('sukimart_nextId', nextId.toString());
      } catch (e) {
        console.warn('Could not save to localStorage:', e);
      }
    }

    function loadFromLocalStorage() {
      try {
        const savedProducts = localStorage.getItem('sukimart_products');
        const savedCart = localStorage.getItem('sukimart_cart');
        const savedNextId = localStorage.getItem('sukimart_nextId');
        
        if (savedProducts) {
          products = JSON.parse(savedProducts);
        }
        if (savedCart) {
          cart = JSON.parse(savedCart);
        }
        if (savedNextId) {
          nextId = parseInt(savedNextId, 10);
        }
      } catch (e) {
        console.warn('Could not load from localStorage:', e);
      }
    }

    // --- Init ---
    document.addEventListener('DOMContentLoaded', () => {
      loadFromLocalStorage();
      displayProducts(products);
      updateCartUI();
      setupEvents();
      updateBuyNowBar(); // ensure initial state
    });

    function setupEvents(){
      cartToggle.addEventListener('click', () => {
        if (isMobile()){
          openMobileCart();
          return;
        }
        openCart();
      });
      
      // Navigation cart toggle
      navCartToggle.addEventListener('click', (e) => {
        e.preventDefault();
        if (isMobile()){
          openMobileCart();
          return;
        }
        openCart();
      });
      
      // Mobile cart modal events
      closeMobileCart.addEventListener('click', closeMobileCartModal);
      mobileCartModal.addEventListener('click', (e) => {
        if (e.target === mobileCartModal) closeMobileCartModal();
      });
      
      if (closeCart) closeCart.addEventListener('click', closeCartSidebar);
      overlay.addEventListener('click', () => { closeCartSidebar(); hideAllModals(); });
      searchInput.addEventListener('input', handleSearch);

      addItemToggle.addEventListener('click', () => openFormForCreate());
      closeForm.addEventListener('click', () => closeAddItemForm());
      productForm.addEventListener('submit', onSubmitProductForm);
      productImageFile.addEventListener('change', handleImageFileChange);
      
      // Image picker events
      removeImageBtn.addEventListener('click', removeImage);

      closeModal.addEventListener('click', () => { checkoutModal.classList.remove('active'); overlay.classList.remove('active'); });

      confirmDeleteBtn.addEventListener('click', confirmDelete);
      cancelDeleteBtn.addEventListener('click', hideDeleteModal);

      // Buy now
      buyNowBtn.addEventListener('click', () => {
        if (cart.length === 0){ showNotification('Your cart is empty!'); return; }
        checkout();
      });

      window.addEventListener('resize', () => {
        updateBuyNowBar();
      });
    }

    // --- Helpers ---
    const isMobile = () => window.innerWidth <= 768;
    function showOverlay(){ overlay.classList.add('active'); }
    function hideOverlay(){ overlay.classList.remove('active'); }
    function hideAllModals(){ checkoutModal.classList.remove('active'); deleteModal.classList.remove('active'); }

    // --- Products ---
    function displayProducts(list){
      productsGrid.innerHTML = '';
      list.forEach(p => {
        const el = document.createElement('div');
        el.className = `product-card ${p.isCustom ? 'custom-item' : ''}`;
        el.innerHTML = `
          ${p.isCustom ? '<div class="custom-badge">NEW</div>' : ''}
          <img class="product-image" src="${p.image}" alt="${escapeHtml(p.name)}" onerror="this.onerror=null;this.src='https://picsum.photos/seed/'+${p.id}+'/800/600';" />
          <div class="product-info">
            <h3 class="product-name">${escapeHtml(p.name)}</h3>
            <div class="product-price">₱${p.price.toFixed(2)}</div>
            <div class="product-rating">
              <span class="stars">${generateStars(p.rating)}</span>
              <span class="rating-text">${p.rating} (${p.reviews} reviews)</span>
            </div>
            <div class="card-actions">
              <button class="btn btn-primary" onclick="addToCart(${p.id})">Add to Cart</button>
              <button class="btn btn-ghost" onclick="openFormForEdit(${p.id})">Edit</button>
              <button class="btn btn-danger" onclick="showDeleteModal(${p.id})">Delete</button>
            </div>
          </div>
        `;
        productsGrid.appendChild(el);
      });
    }

    function generateStars(rating){
      const full = Math.floor(rating); const half = rating % 1 !== 0; let s = '';
      for (let i=0;i<full;i++) s += '★'; if (half) s += '☆'; return s;
    }

    // --- Add/Edit Form Logic ---
    // --- Image Picker Functions ---
    function updateImagePreview(imageSrc) {
      if (imageSrc) {
        imagePreview.src = imageSrc;
        imagePreview.classList.add('has-image');
        imagePlaceholder.style.display = 'none';
        removeImageBtn.classList.add('show');
        imagePicker.classList.add('has-image');
        fileInputLabel.textContent = 'Change Image';
        fileInputLabel.classList.add('has-image');
      } else {
        imagePreview.src = '';
        imagePreview.classList.remove('has-image');
        imagePlaceholder.style.display = 'flex';
        removeImageBtn.classList.remove('show');
        imagePicker.classList.remove('has-image');
        fileInputLabel.textContent = 'Choose Image';
        fileInputLabel.classList.remove('has-image');
      }
    }
    
    function removeImage() {
      productImageFile.value = '';
      if (imagePreview.dataset.objectUrl) {
        try {
          URL.revokeObjectURL(imagePreview.dataset.objectUrl);
        } catch {}
        delete imagePreview.dataset.objectUrl;
      }
      updateImagePreview('');
    }

    function openFormForCreate(){
      formTitle.textContent = 'Add New Product';
      editingId.value = '';
      productForm.reset();
      updateImagePreview('');
      addItemForm.classList.add('active');
      window.scrollTo({ top: addItemForm.offsetTop - 20, behavior: 'smooth' });
    }

    function openFormForEdit(id){
      const p = products.find(x => x.id === id);
      if (!p) return;
      formTitle.textContent = 'Edit Product';
      editingId.value = String(p.id);
      productName.value = p.name;
      productPrice.value = p.price;
      productRating.value = p.rating;
      updateImagePreview(p.image || '');
      productImageFile.value = '';
      addItemForm.classList.add('active');
      window.scrollTo({ top: addItemForm.offsetTop - 20, behavior: 'smooth' });
    }

    function closeAddItemForm(){ 
      addItemForm.classList.remove('active'); 
      productForm.reset(); 
      updateImagePreview('');
    }

    function handleImageFileChange(e){
      const file = e.target.files && e.target.files[0];
      if (file){
        const url = URL.createObjectURL(file);
        imagePreview.dataset.objectUrl = url; // mark for potential revoke
        updateImagePreview(url);
      } else {
        if (imagePreview.dataset.objectUrl) {
          try {
            URL.revokeObjectURL(imagePreview.dataset.objectUrl);
          } catch {}
          delete imagePreview.dataset.objectUrl;
        }
        updateImagePreview('');
      }
    }

    function onSubmitProductForm(e){
      e.preventDefault();
      const idStr = editingId.value.trim();
      const name = productName.value.trim();
      const price = parseFloat(productPrice.value);
      const rating = parseFloat(productRating.value);

      if (!name || !(price >= 0) || !(rating >= 1 && rating <= 5)){
        showNotification('Please fill out the form correctly.');
        return;
      }

      // Determine image to use
      let imageUrl = imagePreview.src || '';
      const hasNewFile = !!productImageFile.files[0];

      if (idStr){
        // Update existing
        const id = parseInt(idStr, 10);
        const idx = products.findIndex(p => p.id === id);
        if (idx !== -1){
          const prev = products[idx];
          // Revoke previous object URL if replaced
          if (hasNewFile && prev.usesObjectURL && prev.image && prev.image.startsWith('blob:')){
            try{ URL.revokeObjectURL(prev.image) }catch{}
          }
          products[idx] = {
            ...prev,
            name,
            price,
            rating,
            image: hasNewFile ? imageUrl : prev.image,
            usesObjectURL: hasNewFile ? true : prev.usesObjectURL
          };
          displayProducts(products);
          showNotification('Product updated');
          saveToLocalStorage();
        }
      } else {
        // Create new
        const newItem = {
          id: nextId++,
          name,
          price,
          image: imageUrl || '',
          rating,
          reviews: Math.floor(Math.random()*50)+1,
          isCustom: true,
          usesObjectURL: !!hasNewFile
        };
        products.unshift(newItem);
        displayProducts(products);
        showNotification('Product added');
        saveToLocalStorage();
      }

      // Cleanup preview object URL (we stored it in products if used)
      if (imagePreview.dataset.objectUrl){
        // keep it; now owned by the product item
        delete imagePreview.dataset.objectUrl;
      }

      closeAddItemForm();
    }

    // --- Delete flow with modal ---
    function showDeleteModal(id){ deleteCandidateId = id; deleteModal.classList.add('active'); showOverlay(); }
    function hideDeleteModal(){ deleteCandidateId = null; deleteModal.classList.remove('active'); maybeHideOverlay(); }
    function confirmDelete(){
      if (deleteCandidateId == null) return;
      const p = products.find(x => x.id === deleteCandidateId);
      // Revoke object URL if any
      if (p && p.usesObjectURL && p.image && p.image.startsWith('blob:')){ try{ URL.revokeObjectURL(p.image) }catch{} }
      products = products.filter(p => p.id !== deleteCandidateId);
      cart = cart.filter(c => c.id !== deleteCandidateId);
      displayProducts(products);
      updateCartUI();
      showNotification('Product deleted successfully!');
      saveToLocalStorage();
      hideDeleteModal();
    }

    function maybeHideOverlay(){ if (!cartSidebar.classList.contains('open') && !deleteModal.classList.contains('active') && !checkoutModal.classList.contains('active')) hideOverlay(); }

    // --- Mobile Cart Modal ---
    function openMobileCart(){
      if (!isMobile()) return;
      updateMobileCartUI();
      mobileCartModal.classList.add('active');
    }

    function closeMobileCartModal(){
      mobileCartModal.classList.remove('active');
    }

    function updateMobileCartUI(){
      mobileCartItems.innerHTML = '';
      let total = 0;
      if (cart.length === 0){
        mobileCartItems.innerHTML = '<div class="empty-cart">Your cart is empty 🛒<small>Add items to see them here.</small></div>';
      } else {
        cart.forEach(item => {
          const row = document.createElement('div');
          row.className = 'cart-item';
          row.innerHTML = `
            <img class="cart-item-image" src="${item.image}" alt="${escapeHtml(item.name)}" onerror="this.onerror=null;this.src='https://picsum.photos/seed/cart${item.id}/120/120';">
            <div style="flex:1">
              <div class="cart-item-name">${escapeHtml(item.name)}</div>
              <div class="cart-item-price">₱${item.price.toFixed(2)}</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="changeQuantity(${item.id}, -1)">−</button>
                <input class="quantity-input" value="${item.quantity}" readonly />
                <button class="quantity-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
              </div>
            </div>
            <button class="remove-item" onclick="removeFromCart(${item.id})">Remove</button>
          `;
          mobileCartItems.appendChild(row);
          total += item.price * item.quantity;
        });
      }
      mobileCartTotal2.textContent = `Total: ₱${total.toFixed(2)}`;
    }

    // --- Cart ---
    function addToCart(productId){
      const product = products.find(p => p.id === productId); if (!product) return;
      const existing = cart.find(i => i.id === productId);
      if (existing) existing.quantity++; else cart.push({ ...product, quantity:1 });
      updateCartUI();
      saveToLocalStorage();

      // Mobile haptics + button bump + BAR BOUNCE
      if (isMobile()){
        try{ if (navigator.vibrate) navigator.vibrate(20); }catch{}
        buyNowBtn.classList.remove('bump'); // restart button animation
        void buyNowBtn.offsetWidth;
        buyNowBtn.classList.add('bump','pulse');
        setTimeout(()=> buyNowBtn.classList.remove('pulse'), 1200);

        // Bounce the entire bar
        buyNowBar.classList.remove('bounce');
        void buyNowBar.offsetWidth;
        buyNowBar.classList.add('bounce');
      }

      showNotification('Added to cart!');
    }

    function updateCartUI(){
      cartItems.innerHTML = '';
      let total = 0;
      if (cart.length === 0){
        cartItems.innerHTML = '<div class="empty-cart">Your cart is empty 🛒<small>Add items to see them here.</small></div>';
      } else {
        cart.forEach(item => {
          const row = document.createElement('div');
          row.className = 'cart-item';
          row.innerHTML = `
            <img class="cart-item-image" src="${item.image}" alt="${escapeHtml(item.name)}" onerror="this.onerror=null;this.src='https://picsum.photos/seed/cart${item.id}/120/120';">
            <div style="flex:1">
              <div class="cart-item-name">${escapeHtml(item.name)}</div>
              <div class="cart-item-price">₱${item.price.toFixed(2)}</div>
              <div class="quantity-controls">
                <button class="quantity-btn" onclick="changeQuantity(${item.id}, -1)">−</button>
                <input class="quantity-input" value="${item.quantity}" readonly />
                <button class="quantity-btn" onclick="changeQuantity(${item.id}, 1)">+</button>
              </div>
            </div>
            <button class="remove-item" onclick="removeFromCart(${item.id})">Remove</button>
          `;
          cartItems.appendChild(row);
          total += item.price * item.quantity;
        });
      }
      cartCount.textContent = cart.reduce((s,i)=>s+i.quantity,0);
      cartTotal.textContent = `Total: ₱${total.toFixed(2)}`;
      updateBuyNowBar();
    }

    function changeQuantity(productId, delta){
      const item = cart.find(i => i.id === productId); if (!item) return;
      item.quantity += delta; if (item.quantity <= 0) cart = cart.filter(i => i.id !== productId);
      updateCartUI();
      // Update mobile cart modal if open
      if (mobileCartModal.classList.contains('active')) {
        updateMobileCartUI();
      }
      saveToLocalStorage();
    }

    function removeFromCart(productId){ 
      cart = cart.filter(i => i.id !== productId); 
      updateCartUI(); 
      // Update mobile cart modal if open
      if (mobileCartModal.classList.contains('active')) {
        updateMobileCartUI();
      }
      showNotification('Product deleted successfully!'); 
      saveToLocalStorage();
    }

    function openCart(){ cartSidebar.classList.add('open'); showOverlay(); }
    function closeCartSidebar(){ cartSidebar.classList.remove('open'); maybeHideOverlay(); }

    // --- Checkout ---
    function checkout(){
      if (cart.length === 0){ showNotification('Your cart is empty!'); return; }
      // Redirect to checkout page
      window.location.href = 'checkout.html';
    }

    // --- Search ---
    function handleSearch(){
      const q = searchInput.value.toLowerCase();
      const filtered = products.filter(p => p.name.toLowerCase().includes(q));
      displayProducts(filtered);
    }

    // --- Mobile Buy Now Bar logic ---
    function updateBuyNowBar(){
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const totalPrice = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      mobileCartCount.textContent = totalItems;
      mobileCartTotal.textContent = totalPrice.toFixed(2);

      if (isMobile()){
        if (totalItems > 0){
          buyNowBar.classList.add('show');
        } else {
          buyNowBar.classList.remove('show');
        }
      } else {
        buyNowBar.classList.remove('show');
      }
    }

    function flashBuyNowBar(){
      if (!isMobile()) return;
      buyNowBar.classList.add('highlight');
      setTimeout(()=> buyNowBar.classList.remove('highlight'), 800);
    }

    // --- Utils ---
    function showNotification(message){
      const n = document.createElement('div');
      n.className = 'toast';
      n.textContent = message;

      if (isMobile()){
        n.classList.add('mobile');
      } else {
        n.classList.add('desktop');
      }

      document.body.appendChild(n);
      // Auto fade-out
      setTimeout(()=>{ n.style.opacity='0'; setTimeout(()=> n.remove(), 400); }, 1600);
    }

    function escapeHtml(str){ return String(str).replace(/[&<>"] /g, s=>({"&":"&amp;","<":"&lt;"," >":"&gt;","\"":"&quot;"," ":"&nbsp;"}[s]||s)); }

    // Expose functions used in inline handlers
    window.addToCart = addToCart;
    window.openFormForEdit = openFormForEdit;
    window.showDeleteModal = showDeleteModal;
    window.changeQuantity = changeQuantity;
    window.removeFromCart = removeFromCart;
    window.checkout = checkout;
    window.closeMobileCart = closeMobileCartModal;
  </script>
</body>
</html>
